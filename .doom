"3.0.0-pre"
((name . doom)
 (version . "3.0.0-pre")
 (homepage . "https://doomemacs.org")

 (commit
  (preset doom-conventional-commits)
  (types "module")
  (scopes "cli" "lib"
          (module)
          (release "modules")
          (docs
           "install"
           (lambda (scope _plist)
             "Allow any filename in docs/* as a scope for docs commits."
             (member
              scope (doom-files-in (doom-path (dir!) "../docs")
                                   :match "\\.org$"
                                   :map #'file-name-base))))
          (lambda (scope _plist)
            "Only allow :CATEGORY or MODULE scopes if they actually exist."
            (doom-glob
             (dir!) "modules" (if (string-prefix-p ":" scope)
                                  (format "%s" (substring scope 1))
                                (format "*/%s" scope))))))

 (make
  (".github/CODEOWNERS"
   "# Auto-generated by 'doom make .github/CODEOWNERS', do not edit it by hand.\n"
   "* @doomemacs/maintainers\n"  ; default until another takes precedence
   "# Module maintainers"
   ,@(cl-sort
      (cl-loop for path in (doom-module-load-path (list doom-modules-dir))
               if (string-match "/modules/\\([^/]+\\)/\\([^/]+\\)$" path)
               collect (format "%-35s @doomemacs/%s-%s"
                               (substring (match-string 0 path) 1)
                               (match-string 1 path)
                               (match-string 2 path)))
      #'string-lessp)))

 (publish
  (targets "docs/index.org" "docs" "modules/*/README.org")
  (env
   (global-menus
    ("± Suggest edits" . "doom-suggest-edit:")
    ("? Help"
     . ,(lambda! (&key title)
          (cond ((equal title "Changelog")   "doom-help-changelog:")
                ((string-prefix-p ":" title) "doom-help-modules:")
                ("doom-help:")))))
   (menus
    (("docs/*.org" "modules/README.org")
     (left ("← Back to index" . "doom-index:")))
    ("docs/index.org"
     (left ("↖ FAQ" . "doom-faq:")))
    ("modules/*/README.org"
     (left ("← Back to module index" . "doom-module-index:")))
    ("modules/*/*/README.org"
     (left ("← Back to module index" . "doom-module-index:"))
     (right ("↖ History"
             . ,(lambda! (&key category module)
                  (format "doom-module-history:%s/%s" (doom-keyword-name category) module)))
            ("! Issues"
             . ,(lambda! (&key category module)
                  (format "doom-module-issues::%s %s" category module))))))))

 (sources
  (doom
   (title . "Doom Core Modules")
   (version . "25.01.0-pre")
   (paths "lisp/" "lisp/modules/*/"))
  (doom+
   (title . "Doom Official Modules")
   (version . "25.01.0-pre")
   (paths "modules/*/" "modules/*/*/"))
  (doom++
   (title . "Doom Community Modules")
   (version . "25.01.0-pre")
   (paths "modules/*/" "modules/*/*/")))

 (profiles
  (test
   (sources doom)
   (modules :doom (cli +ci +buttercup))
   (packages)))

 (packages
  (straight :host github
            :repo "radian-software/straight.el"
            :branch "develop"
            :local-repo "straight.el"
            :files ("straight*.el")
            :pin "33fb4695066781c634ff1c3c81ba96e880deccf7")
  ;; (elpaca :repo "https://github.com/progfolio/elpaca.git"
  ;;         :pin "34b1d1b19d24470758b62ab1d10ed70068186c12"
  ;;         :depth 1
  ;;         :files (:defaults "elpaca-test.el" (:exclude "extensions"))
  ;;         :build (:not elpaca--activate-package))
  ))
